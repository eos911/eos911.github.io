<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css"
          integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
    <link rel="stylesheet" href="css/styles.css">
    <title>EOS911 Emergency</title>
</head>
<body>
<div class="jumbotron jumbotron-fluid">
    <div class="container">
        <h1 class="display-4">EOS911 Emergency</h1>
        <p class="lead">Prove ownership of a hacked eos account on the genesis snapshot</p>
    </div>
</div>
<div class="container">
    <div hidden id="mm_false" class="alert alert-danger" role="alert">
        Your browser is not Web3 compatible, please install <a href="https://metamask.io/" target="_blank"
                                                               class="alert-link">Metamask</a> to continue.
    </div>
    <div hidden id="mm_true" class="alert alert-success" role="alert">
        Metamask detected!
    </div>
    <p style="font-size: large">
        By following the process on this website, you confirm that your <strong>EOS private key</strong> was compromised
        without your prior knowledge.
    </p>
    <p style="font-size: large">Accordingly you give confirmation that you are the rightful owner of the EOS account,
        and consent that it may be
        frozen.
    </p>
    <p style="font-size: large">
        By signing the transaction below you are stating that you legally own your Ethereum private key and may legally
        sign this transaction. Please note any attempt to misuse this website would be a breach of the <strong>EOS
        Constitution</strong>
        <a target="_blank"
           href="https://github.com/EOS-Mainnet/governance/blob/master/eosio.system/eosio.system-clause-constitution-rc.md">eosio.system-clause-constitution-rc.md</a>
    </p>
    <form>
        <div class="input-group mb-3">
            <div class="input-group-prepend">
                <span class="input-group-text" id="basic-addon1">EOS Public Key</span>
            </div>
            <input type="text" id="EOSpublicKEY" class="form-control" placeholder="New EOS Public Key"
                   aria-label="New EOS Public Key"
                   aria-describedby="basic-addon1">
        </div>
        <button type="button" onclick="register()" class="btn btn-primary">Submit</button>
    </form>
    <br>
    <div class="card">
        <h5 class="card-header">Generate new keypair</h5>
        <div class="card-body">
            <form>
                <div class="mb-3">
                    <button type="button" onclick="genKeyPair()" class="btn btn-primary">Generate using eos.js</button>
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="new_public">EOS Public</span>
                    </div>
                    <input type="text" id="new_public_gen" readonly class="form-control" aria-label="New EOS Public Key"
                           aria-describedby="new_public">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" id="new_private">EOS Private</span>
                    </div>
                    <input type="text" id="new_private_gen" readonly class="form-control"
                           aria-describedby="new_private">
                </div>
                <div class="alert alert-danger" role="alert">
                    Remember to backup your private key somewhere safe, you won't have access to it again!
                </div>
            </form>
        </div>
    </div>
</div>
<script src="web3.min.js"></script>
<script src="eos.js"></script>
<script>
    const {ecc} = Eos.modules;
    let publicKey = '';
    let ready = false;
    const web3 = new Web3();
    web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
    window.addEventListener('load', function () {
        web3.version.getNetwork((err, netId) => {
            if (netId !== "1") {
                console.log('Please connect to the Ethereum mainnet!')
            }
        });
        console.log(web3.currentProvider);
        // if (typeof web3 !== 'undefined') {
        //     web3 = new Web3(web3.currentProvider);
        // } else {
        //     // set the provider you want from Web3.providers
        //     web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        // }
        // console.log(web3);
        // if (typeof Web3 !== 'undefined') {
        //     const web3 = new Web3();
        //     console.log(web3);
        //     const coinbase = web3.eth.coinbase;
        //     console.log(web3.eth.getBalance(coinbase));
        //     ready = true;
        //     document.getElementById('mm_true').hidden = false;
        //     setTimeout(() => {
        //         document.getElementById('mm_true').hidden = true;
        //     }, 3000);
        // } else {
        //     console.log('Web3 Not supported! Please use a web3 ready browser!');
        //     document.getElementById('mm_false').hidden = false;
        // }
    });

    function genKeyPair() {
        ecc.initialize().then(() => {
            ecc.randomKey().then(privateKey => {
                document.getElementById("new_private_gen").value = privateKey;
                publicKey = ecc.privateToPublic(privateKey);
                document.getElementById("new_public_gen").value = publicKey;
                document.getElementById("EOSpublicKEY").value = publicKey;
            });
        });
    }

    const abi = [{
        "anonymous": false,
        "inputs": [{"indexed": false, "name": "user", "type": "address"}, {
            "indexed": false,
            "name": "key",
            "type": "string"
        }],
        "name": "LogRegister",
        "type": "event"
    }, {
        "constant": false,
        "inputs": [{"name": "key", "type": "string"}],
        "name": "register",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{"name": "", "type": "address"}],
        "name": "keys",
        "outputs": [{"name": "", "type": "string"}],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }];

    const address = '0x71f2ea939984349838578fbd20fd25e649c1d6a3';

    function initContract(contract) {
        const RecoverEosKey = contract(abi);
        const miniToken = RecoverEosKey.at(address);
        listenForClicks(miniToken)
    }

    function register() {
        if (ready) {

        }
    }
</script>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"
        integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T"
        crossorigin="anonymous"></script>
</body>
</html>